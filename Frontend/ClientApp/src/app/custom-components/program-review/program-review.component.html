<div class="container-fluid mt-3">
    <div class="row">
        <div class="col-md-12">
            <mat-toolbar color="accent" class="slim">
                <mat-icon class="material-icons">analytics</mat-icon>
                <span class="spacer">Annual Program Plan</span>
                <a class="mr-2 bg-white" mat-button mat-dialog-close aria-label="Close">
                    <mat-icon class="ml-2" style="color: #fdb813;">close</mat-icon>
                </a>
            </mat-toolbar>
        </div>
        <div class="col-md-12">
            <div class="ceo-section executive-summary">
                <div class="ceo-section-header">
                    <i class="fas fa-chart-line section-icon"></i>
                    <h3>Executive Summary</h3>
                </div>
                <div class="executive-metrics">
                    <div class="metric-card shadow" matTooltip="Total budget allocated for this program">
                        <div class="metric-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="metric-content">
                            <span class="metric-value"
                                id="ceo-total-budget">{{formatNumber(programBudgetData[0].ProgramBudget)}}</span>
                            <span class="metric-label">Total Budget</span>
                        </div>
                    </div>
                    <div class="metric-card shadow secondary" [matMenuTriggerFor]="districtTooltipMenu">
                        <div class="metric-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <!-- Button or Element -->
                        <div class="metric-content">
                            <!-- <div class="metric-content" [ngbPopover]="districtsPopover" popoverTitle="Target Districts"> -->
                            <!-- <a mat-button color="primary" [ngbPopover]="districtsPopover" popoverTitle="Target Districts"> -->
                            <span class="metric-value"
                                id="ceo-total-trades">{{programOverviewData[0].TotalDistrict}}</span>
                            <span class="metric-label">Target Districts</span>
                            <!-- </a> -->
                        </div>
                    </div>
                    <div class="metric-card shadow secondary" [matMenuTriggerFor]="clustersTooltipMenu">
                        <div class="metric-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="metric-content">
                            <span class="metric-value"
                                id="ceo-total-trades">{{programOverviewData[0].TotalCluster}}</span>
                            <span class="metric-label">Target Clusters</span>
                        </div>
                    </div>
                    <div class="metric-card shadow secondary" [matMenuTriggerFor]="tradeTooltipMenu">
                        <div class="metric-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="metric-content">
                            <span class="metric-value"
                                id="ceo-total-trades">{{programOverviewData[0].TotalTrade}}</span>
                            <span class="metric-label">Total Trade</span>
                        </div>
                    </div>
                    <div class="metric-card shadow secondary" [matMenuTriggerFor]="sectorTooltipMenu">
                        <div class="metric-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="metric-content">
                            <span class="metric-value"
                                id="ceo-total-trades">{{programOverviewData[0].TotalSector}}</span>
                            <span class="metric-label">Total Sector</span>
                        </div>
                    </div>
                    <div class="metric-card shadow tertiary">
                        <div class="metric-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <div class="metric-content">
                            <span class="metric-value" id="ceo-total-lots">{{programOverviewData[0].TotalLot}}</span>
                            <span class="metric-label">Total Trade Lots</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-8">
            <div class="ceo-section program-overview">
                <div class="ceo-section-header">
                    <i class="fas fa-folder-open section-icon"></i>
                    <h3>Program Overview</h3>
                </div>
                <div id="ceo-program-details" class="program-details-grid bg-white">
                    <div class="program-detail-card">
                        <div class="program-detail-header">
                            <div>
                                <h3 class="program-title">{{programOverviewData[0].ProgramName}}</h3>
                                <span class="program-id" color="accent">{{programOverviewData[0].ProgramCode}}</span>
                            </div>
                            <div class="program-budget">{{formatNumber(programBudgetData[0].ProgramBudget)}}</div>
                        </div>
                        <div class="program-metrics">
                            <div class="metric-row">
                                <span class="metric-label">Financial Year:</span>
                                <span class="metric-value">{{programOverviewData[0].FinancialYear}}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Planning Type:</span>
                                <span class="metric-value">{{programOverviewData[0].PTypeName}}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Funding Source:</span>
                                <span class="metric-value">{{programOverviewData[0].FundingSourceName}}</span>
                            </div>
                            <div class="metric-row">
                                <span class="metric-label">Payment Structure:</span>
                                <span class="metric-value">{{programOverviewData[0].SchemeCode}}</span>
                            </div>
                            <!-- <div class="metric-row">
                                <span class="metric-label">Employment Commitment:</span>
                                <span class="metric-value">{{programOverviewData[0].EmploymentCommitment}}</span>
                            </div> -->
                            <div class="metric-row">
                                <span class="metric-label">Program Design Level:</span>
                                <span class="metric-value">{{programOverviewData[0].ProgramDesignOn}}</span>
                                <span class="metric-label">Gender Type:</span>
                                <span class="metric-value">{{programOverviewData[0].GenderName}}</span>
                                <span class="metric-label">Employment Commitment:</span>
                                <span class="metric-value">{{programOverviewData[0].EmploymentCommitment}}</span>
                            </div>
                            <!-- <div class="metric-row">
                                <span class="metric-label">Gender Type:</span>
                                <span class="metric-value">{{programOverviewData[0].GenderName}}</span>
                            </div> -->
                            <div class="metric-row">
                                <span class="metric-value">Program Objective:</span>
                                <span class="metric-label">{{programOverviewData[0].ProgramDescription}}</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6 col-lg-4">
            <div class="ceo-section executive-summary">
                <div class="ceo-section-header">
                    <i class="fas fa-chart-line section-icon"></i>
                    <h3>Estimated Budget Utilization</h3>
                </div>
                <div class="executive-metrics">
                    <div class="metric-card">
                        <div id="budgetUtilizationContainer" style="width: 100%;max-height: 345px !important;"> </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <div class="ceo-section executive-summary">
                <div class="ceo-section-header">
                    <i class="fas fa-chart-line section-icon"></i>
                    <h3>Program Utilized Budget Segregation</h3>
                </div>
                <div class="executive-metrics">
                    <!-- <div class="metric-card secondary">
                        <div class="metric-icon">
                            <i class="fas fa-tools"></i>
                        </div>
                        <div class="metric-content">
                            <span class="metric-value" id="ceo-total-trades">0</span>
                            <span class="metric-label">Trade Designs</span>
                        </div>
                    </div> -->
                    <ng-container *ngFor="let program of programBudgetData">
                        <ng-container *ngFor="let key of getKeys(program)">
                            <ng-container *ngIf="program[key] != 0">
                                <div class="metric-card">
                                    <div class="metric-icon">
                                        <i class="fas fa-chart-bar"></i>
                                    </div>
                                    <div class="metric-content">
                                        <span class="metric-value">
                                            {{ formatNumber(program[key]) }}
                                        </span>
                                        <span class="metric-label">{{ camelCaseToWords(key) }}</span>
                                    </div>
                                </div>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </div>
            </div>
        </div>
        <div class="col-md-12">
            <mat-accordion multi="true" #accordion multi>
                <!-- <div class="col-md-12"> -->
                    <mat-expansion-panel class='my-2 shadow' [expanded]="false"
                        style="border:2px solid #024285;border-radius:8px;">
                        <mat-expansion-panel-header>
                            <mat-panel-title style="font-weight:bold;">Trade Wise Budget Utilization
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="col-md-12 p-1">
                            <div class="ceo-section executive-summary">
                                <!-- <div class="ceo-section-header">
                                <i class="fas fa-chart-line section-icon"></i>
                                <p class="section-icon"> ({{tradeDesignData.length}}) Trades</p>
                                <h3>Trade Wise Budget Utilization</h3>
                            </div> -->
                                <div id="ceo-trades-container" class="trades-analysis-grid m-3">
                                    <ng-container *ngFor="let trade of tradeDesignData">
                                        <div class="trade-analysis-card">
                                            <div class="trade-header border-bottom">
                                                <div>
                                                    <h4 class="trade-name">{{ trade.TradeName }}</h4>
                                                    <span class="trade-id">Program Focus: {{
                                                        trade.ProgramFocusName}}</span>
                                                </div>
                                                <div class="Budget-badge">
                                                    <span class="Budget-value">{{ trade.BudgetPercentage }}%</span>
                                                    <span class="Budget-label">Budget</span>
                                                </div>
                                            </div>
                                            <div class="trade-costs">
                                                <ng-container *ngFor="let key of getKeys(trade)">
                                                    <ng-container *ngIf="trade[key] != 0">
                                                        <div class="cost-item">
                                                            <span class="cost-value"> {{ formatNumber(trade[key])
                                                                }}</span>
                                                            <span class="cost-label">{{camelCaseToWords(key)}}</span>
                                                        </div>
                                                    </ng-container>
                                                </ng-container>
                                            </div>
                                            <div class="trade-insights">
                                                <div class="insight-item">
                                                    <i class="fas fa-users"></i>
                                                    <span><b>Contractual Target:</b>
                                                        {{trade.PerSelectedContraTarget}}</span> |
                                                    <span><b>Completion Target:</b>
                                                        {{trade.PerSelectedCompTarget}}</span>
                                                </div>
                                            </div>
                                        </div>
                                    </ng-container>
                                </div>
                            </div>
                        </div>
                    </mat-expansion-panel>
                <!-- </div> -->
                <!-- <div class="col-md-12"> -->
                    <mat-expansion-panel class='my-2 shadow' [expanded]="false"
                        style="border:2px solid #024285;border-radius:8px;">
                        <mat-expansion-panel-header>
                            <mat-panel-title style="font-weight:bold;">Trade District Wise Budget Utilization
                            </mat-panel-title>
                        </mat-expansion-panel-header>
                        <div class="row border-top">
                            <div class="col-md-12 p-1">
                                <div class="ceo-section executive-summary">
                                    <!-- <div class="ceo-section-header">
                                    <i class="fas fa-chart-line section-icon"></i>
                                    <h3>Trade Lot | District Wise Budget</h3>
                                </div> -->
                                    <div id="ceo-lots-container" class="lots-breakdown-grid">
                                        <ng-container *ngFor="let tradeLot of tradeLotData; let i = index">
                                            <div class="trade-analysis-card">
                                                <div class="trade-header border-bottom">
                                                    <div class="lot-info">
                                                        <h4>LOT{{i + 1}} | {{tradeLot.DistrictName}}</h4>
                                                        <p class="lot-details">
                                                            <strong>Certification Authority:</strong>
                                                            {{tradeLot.CertAuthName}}<br>
                                                            <strong>Curriculum:</strong> {{tradeLot.Name}}
                                                        </p>
                                                    </div>
                                                    <div class="lot-icon">
                                                        <i class="fas fa-layer-group"></i>
                                                    </div>
                                                    <!-- <div class="lot-status">
                                    <span class="status-indicator ready"></span>
                                </div> -->
                                                </div>
                                                <div class="trade-costs">
                                                    <ng-container *ngFor="let key of getKeys(tradeLot)">
                                                        <ng-container *ngIf="tradeLot[key] != 0">
                                                            <div class="cost-item">
                                                                <span class="cost-value"> {{ formatNumber(tradeLot[key])
                                                                    }}</span>
                                                                <span
                                                                    class="cost-label">{{camelCaseToWords(key)}}</span>
                                                            </div>
                                                        </ng-container>
                                                    </ng-container>
                                                </div>
                                                <div class="trade-insights">
                                                    <div class="insight-item">
                                                        <i class="fas fa-users"></i>
                                                        <span><b>Contractual Target:</b>
                                                            {{tradeLot.PerSelectedContraTarget}}</span> |
                                                        <span><b>Completion Target:</b>
                                                            {{tradeLot.PerSelectedCompTarget}}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </ng-container>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </mat-expansion-panel>
                <!-- </div> -->
            </mat-accordion>
        </div>
    </div>
</div>
<!-- Custom Tooltip with Table For district -->
<mat-menu #districtTooltipMenu="matMenu" class="tooltip-table-menu" [overlapTrigger]="false">
    <div style="padding: 10px;">
        <table class="mat-table cdk-table mat-sort table m-0 table-striped table-bordered">
            <thead>
                <tr>
                    <th class="text-3">SR#</th>
                    <th class="text-3">District</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let district of programOverviewData[0].DistrictNames.split('|'); let i = index">
                    <td class="text-3">{{i+1}}</td>
                    <td class="text-3">{{district}}</td>
                </tr>
            </tbody>
        </table>
    </div>
</mat-menu>
<!-- Custom Tooltip with Table For clusters -->
<mat-menu #clustersTooltipMenu="matMenu" [overlapTrigger]="false" class="tooltip-table-menu" [overlapTrigger]="false">
    <div style="padding: 10px;">
        <table class="mat-table cdk-table mat-sort table m-0 table-striped table-bordered">
            <thead>
                <tr>
                    <th class="text-3">SR#</th>
                    <th class="text-3">Cluster</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let cluster of programOverviewData[0].ClusterNames.split('|'); let i = index">
                    <td class="text-3">{{i+1}}</td>
                    <td class="text-3">{{cluster}}</td>
                </tr>
            </tbody>
        </table>
    </div>
</mat-menu>
<!-- Custom Tooltip with Table For Trade -->
<mat-menu #tradeTooltipMenu="matMenu" class="tooltip-table-menu" [overlapTrigger]="false">
    <div style="padding: 10px;">
        <table class="mat-table cdk-table mat-sort m-0 table-striped table-bordered">
            <thead>
                <tr>
                    <th class="text-3">SR#</th>
                    <th class="text-3">Trade</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let trade of programOverviewData[0].TradeNames.split('|'); let i = index">
                    <td class="text-3">{{i+1}}</td>
                    <td class="text-3">{{trade}}</td>
                </tr>
            </tbody>
        </table>
    </div>
</mat-menu>
<!-- Custom Tooltip with Table For Sector -->
<mat-menu #sectorTooltipMenu="matMenu" class="tooltip-table-menu" [overlapTrigger]="false">
    <div style="padding: 10px;">
        <table class="mat-table cdk-table mat-sort table m-0 table-striped table-bordered">
            <thead>
                <tr>
                    <th class="text-3">SR#</th>
                    <th class="text-3">Sector</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let sector of programOverviewData[0].SectorNames.split('|'); let i = index">
                    <td class="text-3">{{i+1}}</td>
                    <td class="text-3">{{sector}}</td>
                </tr>
            </tbody>
        </table>
    </div>
</mat-menu>



